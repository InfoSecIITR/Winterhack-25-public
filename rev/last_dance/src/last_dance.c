#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ptrace.h>
#include <sys/signal.h>
#include <sys/user.h>
#include <sys/wait.h>
#include <unistd.h>

#define YELLOW "\033[1;33m"
#define RED "\033[1;31m"
#define GREEN "\033[1;32m"
#define BLUE "\033[1;34m"
#define BOLD "\033[1m"
#define RESET "\033[0m"

#define LEN 3
#define NCHECKS 28
#define MAXLEN 54
typedef struct {
  long rdi;
  long rsi;
  long rdx;
  long rcx;
  long r8;
  long r9;
} state;

static int lol = 0;
static pid_t pid = 0;
static int status = -1;
volatile int f = NCHECKS - 1;
volatile int trigger = 1;
static int p = 1;
static state states[] = {
    {17, 22, 23, 0, 1, 2},    // 1+2 mod 3 = 0
    {10, 11, 12, 1, 2, 2},    // 2+2 mod 3 = 1
    {42, 15, 29, 2, 1, 4},    // 1+4 mod 3 = 2
    {7, 31, 50, 3, 2, 4},     // 2+4 mod 3 = 0
    {26, 53, 145, 4, 2, 5},   // 2+5 mod 3 = 1
    {19, 48, 28, 5, 1, 7},    // 1+7 mod 3 = 2
    {3, 38, 124, 6, 3, 6},    // 3+6 mod 3 = 0
    {14, 55, 209, 7, 2, 8},   // 2+8 mod 3 = 1
    {29, 44, 78, 8, 4, 7},    // 4+7 mod 3 = 2
    {8, 37, 89, 9, 3, 9},     // 3+9 mod 3 = 0
    {0, 51, 37, 10, 2, 11},   // 2+11 mod 3 = 1
    {16, 47, 53, 11, 5, 9},   // 5+9 mod 3 = 2
    {33, 4, 69, 12, 6, 9},    // 6+9 mod 3 = 0
    {21, 46, 40, 13, 5, 11},  // 5+11 mod 3 = 1
    {9, 36, 123, 14, 4, 13},  // 4+13 mod 3 = 2
    {2, 49, 108, 15, 6, 12},  // 6+12 mod 3 = 0
    {27, 41, 99, 16, 5, 14},  // 5+14 mod 3 = 1
    {6, 35, 27, 17, 7, 13},   // 7+13 mod 3 = 2
    {32, 54, 57, 18, 9, 12},  // 9+12 mod 3 = 0
    {1, 43, 19, 19, 8, 14},   // 8+14 mod 3 = 1
    {20, 52, 91, 20, 7, 16},  // 7+16 mod 3 = 2
    {5, 39, 178, 21, 9, 15},  // 9+15 mod 3 = 0
    {28, 45, 35, 22, 8, 17},  // 8+17 mod 3 = 1
    {18, 40, 87, 23, 10, 16}, // 10+16 mod 3 = 2
    {30, 50, 10, 24, 12, 15}, // 12+15 mod 3 = 0
    {25, 34, 38, 25, 11, 17}, // 11+17 mod 3 = 1
    {12, 23, 24, 26, 13, 16}, // 13+16 mod 3 = 2
    {13, 24, 94, 27, 15, 15}  // 15+15 mod 3 = 0
};

static char flag[MAXLEN];
static unsigned char dance_moves[28][34] = {
    {
        0x73, 0x76, 0x79, 0x74, 0x72, 0x73, 0x76, 0x79, 0x74, 0x72, 0x73, 0xf6,
        0x79, 0x74, 0x72, 0x77, 0x76, 0x79, 0x74, 0x72, 0x73, 0x76, 0x79, 0x74,
        0x72, 0x73, 0x76, 0x79, 0x74, 0x72, 0x73, 0x76, 0x68, 0x62,
    },
    {
        0x7f, 0x6d, 0x60, 0x7f, 0x6d, 0x7f, 0x6f, 0x60, 0x7f, 0x6d, 0x7f, 0x6d,
        0x60, 0x7f, 0x6d, 0x77, 0x6d, 0x60, 0x7f, 0x6d, 0x7f, 0x6d, 0x60, 0x7f,
        0x6d, 0x7f, 0x6d, 0x60, 0x7f, 0x6d, 0x7f, 0x6d, 0x6a, 0x74,
    },
    {
        0x7e, 0x75, 0x7c, 0x7e, 0x75, 0x7c, 0xfe, 0x75, 0x5c, 0x7e, 0x75, 0x7c,
        0x7e, 0x75, 0x7c, 0x7e, 0x75, 0x7c, 0x7e, 0x75, 0x7c, 0x7e, 0x75, 0x7c,
        0x7e, 0x75, 0x7c, 0x7e, 0x75, 0x7c, 0x7e, 0x75, 0x56, 0x71,
    },
    {
        0x56, 0x53, 0x5c, 0x51, 0x57, 0x56, 0xd3, 0x5c, 0x51, 0x57, 0x56, 0x53,
        0x5e, 0x51, 0x57, 0x56, 0x53, 0x5c, 0x51, 0x57, 0x56, 0x53, 0x5c, 0x51,
        0x57, 0x56, 0x53, 0x5c, 0x51, 0x57, 0x56, 0x53, 0x5b, 0x4e,
    },
    {
        0xe2, 0xf0, 0xfd, 0xe2, 0xf0, 0xe2, 0xe0, 0xfd, 0xe2, 0xf0, 0xe2, 0xf0,
        0xfd, 0xe2, 0xf0, 0xc2, 0xf0, 0xfd, 0xe2, 0xf0, 0xe2, 0xf0, 0xfd, 0xe2,
        0xf0, 0xe2, 0xf0, 0xfd, 0xe2, 0xf0, 0xe2, 0xf0, 0xe7, 0xd7,
    },
    {
        0x7f, 0x74, 0x7d, 0x7f, 0x74, 0x7d, 0x7d, 0x74, 0x7d, 0x7f, 0x74, 0xfd,
        0x7f, 0x74, 0x7d, 0x7f, 0x74, 0x7d, 0x7f, 0x74, 0x7d, 0x7f, 0x74, 0x7d,
        0x7f, 0x74, 0x7d, 0x7f, 0x74, 0x7d, 0x7f, 0x74, 0x6e, 0x4f,
    },
    {
        0x18, 0x1d, 0x12, 0x1f, 0x19, 0x18, 0x1d, 0x12, 0x1f, 0x19, 0x8,  0x1d,
        0x12, 0x1f, 0x9,  0x18, 0x1d, 0x12, 0x1f, 0x19, 0x18, 0x1d, 0x12, 0x1f,
        0x19, 0x18, 0x1d, 0x12, 0x1f, 0x19, 0x18, 0x1d, 0x11, 0x39,
    },
    {
        0xa3, 0xb0, 0xbd, 0xa2, 0xb0, 0xa2, 0xa0, 0xbd, 0xa2, 0xb0, 0xa2, 0xb0,
        0xbd, 0xa2, 0xb0, 0xa2, 0xb0, 0xbd, 0xa2, 0xb0, 0xa2, 0xb0, 0xbd, 0xa2,
        0xb0, 0xa2, 0xb0, 0xbd, 0xa2, 0xb0, 0xa2, 0xb0, 0xb3, 0x95,
    },
    {
        0x2d, 0x26, 0x2f, 0x2d, 0x26, 0x2f, 0x3f, 0x26, 0x2f, 0x2d, 0x26, 0x2f,
        0x2d, 0x26, 0x2f, 0x2d, 0x26, 0x2f, 0x2d, 0x26, 0x2f, 0x2d, 0x26, 0x2f,
        0x2d, 0x26, 0x2f, 0x2d, 0x26, 0x2f, 0x2d, 0x26, 0x32, 0x1,
    },
    {
        0x3d, 0x38, 0x37, 0x3a, 0x3c, 0x3d, 0x38, 0x37, 0x3a, 0x3c, 0x3c, 0x38,
        0x3f, 0x3a, 0x3c, 0x3d, 0x38, 0x37, 0x3a, 0x3c, 0x3d, 0x38, 0x37, 0x3a,
        0x3c, 0x3d, 0x38, 0x37, 0x3a, 0x3c, 0x3d, 0x38, 0x3f, 0x1f,
    },
    {
        0x56, 0x44, 0x49, 0x56, 0x44, 0x56, 0x4c, 0x49, 0x56, 0x44, 0x56, 0x44,
        0x49, 0x56, 0xc4, 0x56, 0x44, 0x49, 0x56, 0x44, 0x56, 0x44, 0x49, 0x56,
        0x44, 0x56, 0x44, 0x49, 0x56, 0x44, 0x56, 0x44, 0x49, 0x65,
    },
    {
        0x56, 0x5d, 0x54, 0x56, 0x5d, 0x54, 0x56, 0x5d, 0x54, 0x56, 0x5d, 0xd4,
        0x46, 0x5d, 0x54, 0x56, 0x5d, 0x54, 0x56, 0x5d, 0x54, 0x56, 0x5d, 0x54,
        0x56, 0x5d, 0x54, 0x56, 0x5d, 0x54, 0x56, 0x5d, 0x44, 0x79,
    },
    {
        0x21, 0x24, 0x2b, 0x26, 0x20, 0x21, 0x34, 0x2b, 0x26, 0x20, 0x21, 0x24,
        0xb,  0x26, 0x20, 0x21, 0x24, 0x2b, 0x26, 0x20, 0x21, 0x24, 0x2b, 0x26,
        0x20, 0x21, 0x24, 0x2b, 0x26, 0x20, 0x21, 0x24, 0xa,  0x22,
    },
    {
        0x5b, 0x49, 0x44, 0x5b, 0x49, 0x5b, 0x49, 0x44, 0x5b, 0x49, 0x5b, 0xc9,
        0x44, 0x1b, 0x49, 0x5b, 0x49, 0x44, 0x5b, 0x49, 0x5b, 0x49, 0x44, 0x5b,
        0x49, 0x5b, 0x49, 0x44, 0x5b, 0x49, 0x5b, 0x49, 0x51, 0x75,
    },
    {
        0x18, 0x13, 0x1a, 0x18, 0x13, 0x1a, 0x18, 0x13, 0x1a, 0x18, 0x13, 0x9a,
        0x18, 0x1b, 0x1a, 0x18, 0x13, 0x1a, 0x18, 0x13, 0x1a, 0x18, 0x13, 0x1a,
        0x18, 0x13, 0x1a, 0x18, 0x13, 0x1a, 0x18, 0x13, 0x13, 0x3c,
    },
    {
        0x8, 0xd, 0x2, 0xf, 0x9, 0x8, 0xd, 0x2, 0xf, 0x9,  0x8, 0xd,
        0x2, 0xf, 0x9, 0x8, 0xd, 0x2, 0xf, 0x9, 0x8, 0xd,  0x2, 0xf,
        0x9, 0x8, 0xd, 0x2, 0xf, 0x9, 0x8, 0xd, 0x0, 0x3e,
    },
    {
        0x10, 0x2,  0xf, 0x10, 0x2,  0x10, 0x2,  0xf, 0x18, 0x2,  0x10, 0x2,
        0xf,  0x18, 0x2, 0x10, 0x2,  0xf,  0x10, 0x2, 0x10, 0x2,  0xf,  0x10,
        0x2,  0x10, 0x2, 0xf,  0x10, 0x2,  0x10, 0x2, 0x14, 0x39,
    },
    {
        0x78, 0x73, 0x7a, 0x78, 0x73, 0x7a, 0x78, 0x73, 0x7a, 0x78, 0x73, 0x7a,
        0x68, 0x72, 0x7a, 0x78, 0x73, 0x7a, 0x78, 0x73, 0x7a, 0x78, 0x73, 0x7a,
        0x78, 0x73, 0x7a, 0x78, 0x73, 0x7a, 0x78, 0x73, 0x7c, 0x5b,
    },
    {
        0x5c, 0x58, 0x57, 0x5a, 0x5c, 0x5d, 0x58, 0x57, 0x5a, 0x5c, 0x5d, 0xd8,
        0x57, 0x5a, 0x5c, 0x5d, 0x58, 0x57, 0x5a, 0x5c, 0x5d, 0x58, 0x57, 0x5a,
        0x5c, 0x5d, 0x58, 0x57, 0x5a, 0x5c, 0x5d, 0x58, 0x77, 0x6c,
    },
    {
        0x60, 0x72, 0x7f, 0x60, 0x72, 0x60, 0x72, 0x7f, 0x60, 0x72, 0x60, 0xf2,
        0x7f, 0x62, 0x72, 0x60, 0x72, 0x7f, 0x60, 0x72, 0x60, 0x72, 0x7f, 0x60,
        0x72, 0x60, 0x72, 0x7f, 0x60, 0x72, 0x60, 0x72, 0x7e, 0x4b,
    },
    {
        0x38, 0x33, 0x3a, 0x38, 0x33, 0x3a, 0x3a, 0x33, 0x3a, 0x38, 0x33, 0x3a,
        0x38, 0x33, 0x3e, 0x38, 0x33, 0x3a, 0x38, 0x33, 0x3a, 0x38, 0x33, 0x3a,
        0x38, 0x33, 0x3a, 0x38, 0x33, 0x3a, 0x38, 0x33, 0x2e, 0xc,
    },
    {
        0xd6, 0xd3, 0xdc, 0xd1, 0xd7, 0xd6, 0xd3, 0xdc, 0xd1, 0xd7, 0xd2, 0xd3,
        0xdc, 0xd1, 0xd3, 0xd6, 0xd3, 0xdc, 0xd1, 0xd7, 0xd6, 0xd3, 0xdc, 0xd1,
        0xd7, 0xd6, 0xd3, 0xdc, 0xd1, 0xd7, 0xd6, 0xd3, 0xd9, 0xf6,
    },
    {
        0x50, 0x42, 0x4f, 0x50, 0x42, 0x50, 0x42, 0x4f, 0x50, 0x42, 0x50, 0x42,
        0xf,  0x10, 0x42, 0x50, 0x42, 0x4f, 0x50, 0x42, 0x50, 0x42, 0x4f, 0x50,
        0x42, 0x50, 0x42, 0x4f, 0x50, 0x42, 0x50, 0x42, 0x53, 0x7d,
    },
    {
        0x34, 0x3f, 0x36, 0x34, 0x3f, 0x36, 0x3c, 0x3f, 0x34, 0x34, 0x3f, 0x36,
        0x34, 0x3f, 0x36, 0x34, 0x3f, 0x36, 0x34, 0x3f, 0x36, 0x34, 0x3f, 0x36,
        0x34, 0x3f, 0x36, 0x34, 0x3f, 0x36, 0x34, 0x3f, 0x24, 0x1c,
    },
    {
        0x6e, 0x6b, 0x64, 0x69, 0x6f, 0x6e, 0x4b, 0x64, 0x69, 0x6f, 0x6e, 0x6b,
        0x64, 0x29, 0x6f, 0x6e, 0x6b, 0x64, 0x69, 0x6f, 0x6e, 0x6b, 0x64, 0x69,
        0x6f, 0x6e, 0x6b, 0x64, 0x69, 0x6f, 0x6e, 0x6b, 0x7a, 0x5b,
    },
    {
        0x55, 0x47, 0x4a, 0x55, 0x47, 0x55, 0x4f, 0x4a, 0x55, 0x47, 0x55, 0x47,
        0x4a, 0x15, 0x47, 0x55, 0x47, 0x4a, 0x55, 0x47, 0x55, 0x47, 0x4a, 0x55,
        0x47, 0x55, 0x47, 0x4a, 0x55, 0x47, 0x55, 0x47, 0x53, 0x77,
    },
    {
        0x7b, 0x70, 0x79, 0x7b, 0x70, 0x79, 0x7b, 0x70, 0x79, 0x7b, 0x70, 0xf9,
        0x7f, 0x70, 0x79, 0x7b, 0x70, 0x79, 0x7b, 0x70, 0x79, 0x7b, 0x70, 0x79,
        0x7b, 0x70, 0x79, 0x7b, 0x70, 0x79, 0x7b, 0x70, 0x75, 0x6c,
    },
    {
        0x3a, 0x3f, 0x30, 0x3d, 0x3b, 0x3a, 0x37, 0x30, 0x3d, 0x3b, 0x3a, 0x3f,
        0x30, 0x3d, 0x3f, 0x3a, 0x3f, 0x30, 0x3d, 0x3b, 0x3a, 0x3f, 0x30, 0x3d,
        0x3b, 0x3a, 0x3f, 0x30, 0x3d, 0x3b, 0x3a, 0x3f, 0x3d, 0x25,
    },

};
static uint64_t dance(long rdi, long rsi, long rdx, long rcx) {
  // printf("[" BLUE BOLD "CALL" RESET "] dance (%d, %d, %d, %d)\n", rdi, rsi,
  // rdx, rcx); register long r8 asm("r8"); register long r9 asm("r9");
  // printf("[" BLUE BOLD "DEBUG" RESET "] r8: %d, r9: %d\n", r8, r9);
  unsigned char dance[] = "dancedancedancedancedancedancedanc";
  char c = flag[rdi];
  *(dance + (c >> 3)) ^= (1 << (c % 8));
  dance[32] ^= (rdi);
  c = flag[rsi];
  *(dance + (c >> 3)) ^= (1 << (c % 8));
  dance[33] ^= (rsi);
  int ret = 1;
  for (int i = 0; i < 34; i++) {
    dance[i] ^= (unsigned char)rdx;
    if (dance[i] != dance_moves[rcx][i]) {
      ret = 0;
    }
  }
  // if (ret)
  // {
  //     printf(GREEN BOLD "PASS" RESET "\n");
  // }
  // else
  // {
  //     printf(RED BOLD "FAIL" RESET "\n");
  // }
  return ret;
}
static uint64_t salsa(long rdi, long rsi, long rdx, long rcx) {
  // printf("[" BLUE BOLD "CALL" RESET "] salsa (%d, %d, %d, %d)\n", rdi, rsi,
  // rdx, rcx); register long r8 asm("r8"); register long r9 asm("r9");
  // printf("[" BLUE BOLD "DEBUG" RESET "] r8: %d, r9: %d\n", r8, r9);
  unsigned char salsa[] = "salsasalsasalsasalsasalsasalsasals";
  char c = flag[rdi];
  *(salsa + (c >> 3)) ^= (1 << (c % 8));
  salsa[32] ^= (rdi);
  c = flag[rsi];
  *(salsa + (c >> 3)) ^= (1 << (c % 8));
  salsa[33] ^= (rsi);
  int ret = 1;
  for (int i = 0; i < 34; i++) {
    salsa[i] ^= (unsigned char)rdx;
    if (salsa[i] != dance_moves[rcx][i]) {
      ret = 0;
    }
  }
  // if (ret)
  // {
  //     printf(GREEN BOLD "PASS" RESET "\n");
  // }
  // else
  // {
  //     printf(RED BOLD "FAIL" RESET "\n");
  // }
  return ret;
}
static uint64_t chacha(long rdi, long rsi, long rdx, long rcx) {
  // printf("[" BLUE BOLD "CALL" RESET "] chacha (%d, %d, %d, %d)\n", rdi, rsi,
  // rdx, rcx); register long r8 asm("r8"); register long r9 asm("r9");
  // printf("[" BLUE BOLD "DEBUG" RESET "] r8: %d, r9: %d\n", r8, r9);
  unsigned char chacha[] = "chachachachachachachachachachachac";
  char c = flag[rdi];
  *(chacha + (c >> 3)) ^= (1 << (c % 8));
  chacha[32] ^= (rdi);
  c = flag[rsi];
  *(chacha + (c >> 3)) ^= (1 << (c % 8));
  chacha[33] ^= (rsi);
  int ret = 1;
  for (int i = 0; i < 34; i++) {
    chacha[i] ^= (unsigned char)rdx;
    if (chacha[i] != dance_moves[rcx][i]) {
      ret = 0;
    }
  }
  // if (ret)
  // {
  //     printf(GREEN BOLD "PASS" RESET "\n");
  // }
  // else
  // {
  //     printf(RED BOLD "FAIL" RESET "\n");
  // }
  return ret;
}
static uint64_t (*checks[])(long, long, long, long) = {
    dance,
    salsa,
    chacha,
};
static int check(long rdi, long rsi, long rdx, long rcx, long r8, long r9) {
  int t;
  // mov the value of r9 in t
  asm volatile("movq %%rsi, %%rax\n"
               "cqto\n"        /* Sign extend RAX into RDX:RAX */
               "idivq %%rdi\n" /* Divide RDX:RAX by RDI */
               "addq %%r8, %%r9\n"
               "movq %%r9, %%rax\n"
               "xorq %%rdx, %%rdx\n"
               "movq $3, %%rcx\n"
               "divq %%rcx\n"     /* Divide by 3, remainder goes in RDX */
               "movl %%edx, %0\n" /* Store remainder in t */
               : "=r"(t)
               :
               : "rax", "rdx", "rcx");
  t = checks[t](rdi, rsi, rdx, rcx);
  // printf("[" YELLOW BOLD "DEBUG" RESET "] t: %d\n", t);
  return t;
}

void sig_handler(int signo) {
  struct user_regs_struct regs;
  if (signo == SIGCHLD) {
    waitpid(pid, &status, WNOHANG);
    // printf("status: %x\n", status);
    if (WIFEXITED(status)) {
      // printf("Child %d has been " RED BOLD "murdered" RESET ".\n", lol++);
      p &= WEXITSTATUS(status);
      trigger = 0;
    }

    if (WIFSTOPPED(status) && WSTOPSIG(status) == SIGFPE) {
      ptrace(PTRACE_GETREGS, pid, 0, &regs);
      regs.rip += 3;
      long rbp = regs.rbp;
      long rdi = states[f].rdi;
      ptrace(PTRACE_POKEDATA, pid, rbp - 0x18, rdi);
      long rsi = states[f].rsi;
      ptrace(PTRACE_POKEDATA, pid, rbp - 0x20, rsi);
      long rdx = states[f].rdx;
      ptrace(PTRACE_POKEDATA, pid, rbp - 0x28, rdx);
      long rcx = states[f].rcx;
      ptrace(PTRACE_POKEDATA, pid, rbp - 0x30, rcx);
      long r8 = states[f].r8;
      regs.r8 = states[f].r8;
      ptrace(PTRACE_POKEDATA, pid, rbp - 0x38, r8);
      long r9 = states[f].r9;
      regs.r9 = states[f].r9;
      ptrace(PTRACE_POKEDATA, pid, rbp - 0x40, r9);
      ptrace(PTRACE_SETREGS, pid, 0, &regs);
      f -= 1;
    }
    ptrace(PTRACE_CONT, pid, 0, 0);
  }
  status = -1;
}
int main() {
  signal(SIGCHLD, sig_handler);
  char buf[256];
  read(STDIN_FILENO, buf, MAXLEN);
  memcpy(flag, buf, MAXLEN);
  for (int i = 0; i < NCHECKS; i++) {
    trigger = 1;
    if ((pid = fork()) == 0) {
      ptrace(PTRACE_TRACEME, 0, 0, 0);
      int t;
      t = check(0L, 0L, 0L, 0L, 0L, 0L);
      exit(t);
    } else {
      ptrace(PTRACE_ATTACH, pid, 0, 0);
      while (trigger) {
        pause();
      }
    }
  }
  if (p)
    printf(GREEN BOLD "Correct!\n" RESET);
  else
    printf(RED BOLD "Wrong!\n" RESET);
  return 0;
}